window.TouchController=function(){function k(b,c,a){return c===b&&a in p?(b=p[a],null!==b.onClick&&b.onClick.call(b),!0):!1}function n(b,c){this.allowOnClick=!0;var a=document.getElementById(b);if(l){var d=function(a){e.pressed=!1;a.preventDefault();e.allowOnClick&&null!==e.onRelease&&e.onRelease.call(e)},f="";"undefined"===typeof c&&(c={});"bottom"in c?f+="bottom:"+c.bottom+"px;":"top"in c&&(f+="top:"+c.top+"px;");"left"in c?f+="left:"+c.left+"px;":"right"in c&&(f+="right:"+c.right+"px;");var g=
    "touchController"+s++;a.innerHTML='<div style="'+f+'" id="'+g+'" class="touchController"><div class="innerTouchController"></div></div>';this.fy=this.fx=-1;this.pressed=!1;this.y=this.x=0;var e=this;this.onRelease=this.onClick=null;a.addEventListener("touchstart",function(a){e.pressed=!0;a.preventDefault();e.fx=a.changedTouches[0].screenX;e.fy=a.changedTouches[0].screenY-q;e.allowOnClick&&null!==e.onClick&&e.onClick.call(e)},!1);a.addEventListener("touchend",d,!1);a.addEventListener("touchmove",function(a){a.preventDefault();
    e.fx=a.changedTouches[0].screenX;e.fy=a.changedTouches[0].screenY-q;e.allowOnClick&&null!==e.onClick&&e.onClick.call(e)},!1);a.addEventListener("touchcancel",d,!1);setTimeout(function(){var a,c;a=document.getElementById(g).getBoundingClientRect();var b=document.body,d=document.documentElement;c=a.left+(window.pageXOffset||d.scrollLeft||b.scrollLeft)-(d.clientLeft||b.clientLeft||0);a=Math.round(a.top+(window.pageYOffset||d.scrollTop||b.scrollTop)-(d.clientTop||b.clientTop||0));c=Math.round(c);e.x=
    c+Math.ceil(70);e.y=a+Math.ceil(70)},100)}else a.parentNode.removeChild(a)}function c(b,h){n.call(this,b,h);if("WASDEvents"in h&&h.WASDEvents){-1!==r&&clearInterval(r);var a=this,d=0,f=!0,g=null,e=!1,k=-1;if(l)this.onClick=function(){var b=(new Date).getTime();if(f)switch(d=b,f=!1,a.getDirection()){case c.UP:null!==a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}else if(500<
    b-d)switch(d=b,a.getDirection()){case c.UP:null!==a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}},this.onRelease=function(){f=!0},g=function(){if(a.isPressed()){var b=(new Date).getTime();if(500<b-d)switch(d=b,a.getDirection()){case c.UP:null!==a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);
    break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}}};else{var m={87:!1,65:!1,68:!1,83:!1};document.onkeydown=function(b){b=b.keyCode;if(87===b||65===b||68===b||83===b){k=b;m[""+b]=!0;a.keyDirection=k;e=!0;var g=(new Date).getTime();if(f)switch(d=g,f=!1,b){case c.UP:null!==a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}else if(500<g-d)switch(d=g,b){case c.UP:null!==
a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}}};document.onkeyup=function(b){b=b.keyCode;if(87===b||65===b||68===b||83===b)m[""+b]=!1,m["87"]||m["65"]||m["68"]||m["83"]||(a.keyDirection=c.NONE,e=!1,f=!0)};g=function(){if(e){var b=(new Date).getTime();if(500<b-d)switch(d=b,k){case c.UP:null!==a.onUp&&a.onUp.call(a);break;case c.DOWN:null!==a.onDown&&a.onDown.call(a);
    break;case c.LEFT:null!==a.onLeft&&a.onLeft.call(a);break;case c.RIGHT:null!==a.onRight&&a.onRight.call(a)}}}}r=setInterval(g,125);this.onRight=this.onLeft=this.onDown=this.onUp=null}this.keyDirection=c.NONE}var s=0,l="ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints,t=-1<navigator.userAgent.toLowerCase().indexOf("chrome"),u=180/Math.PI,q=0;t&&(q=100);var p={},h={SPACE:"sp",ENTER:"en",ESC:"esc",Q:"q",E:"e"};l||(document.onkeyup=function(b){b=b.keyCode;87!==b&&65!==
    b&&83!==b&&68!==b&&(k(b,32,h.SPACE)||k(b,13,h.ENTER)||k(b,27,h.ESC)||k(b,81,h.Q)||k(b,69,h.E))});l&&document.write("<style>.touchController{ width:140px;height:140px;border:2px solid black;position:absolute;border-radius:50%; } .innerTouchController {width:5px;height:5px;margin-left:auto;margin-right:auto;margin-top:"+Math.ceil(70)+"px;background-color:black;}.touchBtn{position:absolute;border:2px solid black;position:absolute;border-radius:50%;width:65px;height:65px;}.touchBtnTxt{text-align:center;line-height:65px;}.touchBtn.pressed{background-color:cornflowerblue;}</style>");
    n.prototype.isPressed=function(){return this.pressed};n.prototype.getDegree=function(){var b=Math.atan2(-(this.y-this.fy),this.x-this.fx);0>b&&(b+=2*Math.PI);return b*u};var r=-1;c.prototype=Object.create(n.prototype);c.UP=87;c.DOWN=83;c.LEFT=65;c.RIGHT=68;c.NONE=-1;c.prototype.getDirection=l?function(){if(this.isPressed()){var b=this.getDegree();return 45>b||315<=b?c.LEFT:315>b&&225<=b?c.UP:225>b&&135<=b?c.RIGHT:c.DOWN}return c.NONE}:function(){return this.keyDirection};return{KEYS:h,AnalogStick:n,
        DPad:c,Button:function(b,c,a){b=document.getElementById(b);if(l){var d="";"undefined"===typeof a&&(a={});"bottom"in a?d+="bottom:"+a.bottom+"px;":"top"in a&&(d+="top:"+a.top+"px;");"left"in a?d+="left:"+a.left+"px;":"right"in a&&(d+="right:"+a.right+"px;");var f="touchBtn"+s++;b.innerHTML='<div style="'+d+'" id="'+f+'" class="touchBtn"><div class="touchBtnTxt">'+c+"</div></div>";var g=this;b.addEventListener("touchstart",function(a){document.getElementById(f).className="touchBtn pressed";a.preventDefault()},
            !1);b.addEventListener("touchend",function(a){null!==g.onClick&&g.onClick.call(g);document.getElementById(f).className="touchBtn";a.preventDefault()},!1);b.addEventListener("touchcancel",function(a){document.getElementById(f).className="touchBtn";a.preventDefault()},!1)}else b.parentNode.removeChild(b),"key"in a&&(p[a.key]=this);this.onClick=null},isTouchDevice:l}}();